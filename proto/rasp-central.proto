syntax = "proto3";

option go_package = "github.com/n1k1x86/rasp-grpc-contract/gen";

message RegAgentRequest {
    string ServiceID = 1;
    string AgentName = 2; 
    string AgentType = 3;
}

message RegAgentResponse {
    int64 Status = 1;
    string Detail = 2;
    string AgentID = 3;
    string ServiceID = 4;
}

message AgentRequest {
    string AgentID = 1;
    string AgentType = 2;
}

message CloseAgentResponse {
    string Detail = 1;
}

message UpdatedSSRFRules {
    repeated string HostRules = 1;
    repeated string IPRules = 2;
    repeated string RegexpRules = 3;
}

message NewRules {
    oneof payload {
        UpdatedSSRFRules Rules = 1;
    }
}

message IsServiceRegisteredReq {
    string ServiceID = 1;
}

message IsServiceRegisteredResp {
    bool IsRegistered = 1;
}

service RASPCentral {
    rpc RegAgent(RegAgentRequest) returns (RegAgentResponse);
    rpc CloseAgent(AgentRequest) returns (CloseAgentResponse);
    rpc IsServiceRegistered(IsServiceRegisteredReq) returns (IsServiceRegisteredResp);
    rpc SyncRules(AgentRequest) returns (stream NewRules);
}